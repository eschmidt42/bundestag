<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://eschmidt42.github.io/bundestag/bundestag/data/transform/bundestag_sheets/" />
      <link rel="shortcut icon" href="../../../../img/favicon.ico" />
    <title>bundestag_sheets - bundestag</title>
    <link rel="stylesheet" href="../../../../css/theme.css" />
    <link rel="stylesheet" href="../../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "bundestag_sheets";
        var mkdocs_page_input_path = "bundestag/data/transform/bundestag_sheets.md";
        var mkdocs_page_url = "/bundestag/bundestag/data/transform/bundestag_sheets/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../../.." class="icon icon-home"> bundestag
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../../installation/">Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../../how-to-use/">How to use</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Analysis</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../analysis-highlights/">Embeddings</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../fraktionszwang/">Fraktionszwang</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Documentation</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" >cli</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../cli/__main__/">__main__</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../cli/download/">download</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../cli/transform/">transform</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../cli/utils/">utils</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >data</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../../">__init__</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >download</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >abgeordnetenwatch</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../download/abgeordnetenwatch/cli/">cli</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../download/abgeordnetenwatch/download/">download</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../download/abgeordnetenwatch/request/">request</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../download/abgeordnetenwatch/store/">store</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../download/bundestag_sheets/">bundestag_sheets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../download/huggingface/">huggingface</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" >transform</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" >abgeordnetenwatch</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../abgeordnetenwatch/helper/">helper</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../abgeordnetenwatch/transform/">transform</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" >process</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="#">bundestag_sheets</a>
    <ul class="current">
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/">utils</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >ml</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../ml/poll_clustering/">poll_clustering</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ml/similarity/">similarity</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../ml/vote_prediction/">vote_prediction</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../gui/">gui</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../fine_logging/">fine_logging</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../paths/">paths</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../schemas/">schemas</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../..">bundestag</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Documentation</li>
          <li class="breadcrumb-item">data</li>
          <li class="breadcrumb-item">transform</li>
      <li class="breadcrumb-item active">bundestag_sheets</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/eschmidt42/bundestag/edit/master/docs/bundestag/data/transform/bundestag_sheets.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div class="doc doc-object doc-module">



<a id="bundestag.data.transform.bundestag_sheets"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="bundestag.data.transform.bundestag_sheets.assign_date_and_title_columns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">assign_date_and_title_columns</span><span class="p">(</span><span class="n">sheet_file</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">file_title_maps</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Assigns 'date' and 'title' columns to a DataFrame based on the sheet file.</p>
<p>This function uses a mapping from file names to poll titles to find the full title for the given <code>sheet_file</code>.
It then calls <code>handle_title_and_date</code> to extract the clean title and date, and adds them as new columns
to the DataFrame.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>sheet_file</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>The path to the sheet file being processed.</p>
              </div>
            </li>
            <li>
              <b><code>df</code></b>
                  (<code><span title="polars.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>The DataFrame to which the columns will be added.</p>
              </div>
            </li>
            <li>
              <b><code>file_title_maps</code></b>
                  (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>] | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>A mapping from file names to full poll titles. Defaults to None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
              –
              <div class="doc-md-description">
                <p>pl.DataFrame: The DataFrame with 'date' and 'title' columns added.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/bundestag/data/transform/bundestag_sheets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">assign_date_and_title_columns</span><span class="p">(</span>
    <span class="n">sheet_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">file_title_maps</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assigns &#39;date&#39; and &#39;title&#39; columns to a DataFrame based on the sheet file.</span>

<span class="sd">    This function uses a mapping from file names to poll titles to find the full title for the given `sheet_file`.</span>
<span class="sd">    It then calls `handle_title_and_date` to extract the clean title and date, and adds them as new columns</span>
<span class="sd">    to the DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        sheet_file (Path): The path to the sheet file being processed.</span>
<span class="sd">        df (pl.DataFrame): The DataFrame to which the columns will be added.</span>
<span class="sd">        file_title_maps (dict[str, str] | None, optional): A mapping from file names to full poll titles. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pl.DataFrame: The DataFrame with &#39;date&#39; and &#39;title&#39; columns added.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">file_title_maps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sheet_file</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">file_title_maps</span><span class="p">:</span>
        <span class="n">title</span><span class="p">,</span> <span class="n">date</span> <span class="o">=</span> <span class="n">handle_title_and_date</span><span class="p">(</span>
            <span class="n">file_title_maps</span><span class="p">[</span><span class="n">sheet_file</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="n">sheet_file</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">title</span><span class="p">,</span> <span class="n">date</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
        <span class="o">**</span><span class="p">{</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">date</span><span class="p">),</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">title</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bundestag.data.transform.bundestag_sheets.create_vote_column" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_vote_column</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Transforms wide-format vote columns into a single 'vote' column.</p>
<p>This function takes a DataFrame with separate columns for each vote type (e.g., 'ja', 'nein')
and unpivots it to create a single 'vote' column that contains the type of vote cast for each row.
Rows where no vote was cast (all vote columns are 0) are marked as 'error'.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df</code></b>
                  (<code><span title="polars.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>The input DataFrame with vote columns in wide format.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
              –
              <div class="doc-md-description">
                <p>pl.DataFrame: The transformed DataFrame with a single 'vote' column.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/bundestag/data/transform/bundestag_sheets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_vote_column</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transforms wide-format vote columns into a single &#39;vote&#39; column.</span>

<span class="sd">    This function takes a DataFrame with separate columns for each vote type (e.g., &#39;ja&#39;, &#39;nein&#39;)</span>
<span class="sd">    and unpivots it to create a single &#39;vote&#39; column that contains the type of vote cast for each row.</span>
<span class="sd">    Rows where no vote was cast (all vote columns are 0) are marked as &#39;error&#39;.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pl.DataFrame): The input DataFrame with vote columns in wide format.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pl.DataFrame: The transformed DataFrame with a single &#39;vote&#39; column.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Keep original columns to join back later</span>
    <span class="n">original_cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>

    <span class="c1"># Add a unique row identifier to pivot and join correctly</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_row_index</span><span class="p">(</span><span class="s2">&quot;__row_nr__&quot;</span><span class="p">)</span>

    <span class="c1"># Unpivot the DataFrame to long format</span>
    <span class="n">unpivoted</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">unpivot</span><span class="p">(</span>
        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;__row_nr__&quot;</span><span class="p">],</span> <span class="n">on</span><span class="o">=</span><span class="n">VOTE_COLS</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s2">&quot;vote&quot;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;value&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Filter for the cast votes (where value is 1)</span>
    <span class="n">votes</span> <span class="o">=</span> <span class="n">unpivoted</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;__row_nr__&quot;</span><span class="p">,</span> <span class="s2">&quot;vote&quot;</span><span class="p">])</span>

    <span class="c1"># Join the vote information back to the original DataFrame</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">votes</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;__row_nr__&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

    <span class="c1"># For rows where no vote was cast, the &#39;vote&#39; column will be null.</span>
    <span class="c1"># We fill these with &#39;error&#39;.</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">vote</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;vote&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fill_null</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">))</span>

    <span class="c1"># Return the DataFrame with the original columns plus the new &#39;vote&#39; column</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">original_cols</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;vote&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bundestag.data.transform.bundestag_sheets.disambiguate_party" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">disambiguate_party</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;Fraktion/Gruppe&#39;</span><span class="p">,</span> <span class="n">party_map</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Disambiguates party names in a DataFrame column.</p>
<p>This function maps certain party names to a standardized form using a provided dictionary.
For example, it can map "BÜNDNIS`90/DIE GRÜNEN" to "BÜ90/GR".</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df</code></b>
                  (<code><span title="polars.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>The DataFrame containing the party names.</p>
              </div>
            </li>
            <li>
              <b><code>col</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;Fraktion/Gruppe&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The name of the column with party names. Defaults to "Fraktion/Gruppe".</p>
              </div>
            </li>
            <li>
              <b><code>party_map</code></b>
                  (<code><span title="dict">dict</span> | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>A dictionary for mapping party names. If None, a default map is used.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
              –
              <div class="doc-md-description">
                <p>pl.DataFrame: The DataFrame with the disambiguated party names.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/bundestag/data/transform/bundestag_sheets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">disambiguate_party</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Fraktion/Gruppe&quot;</span><span class="p">,</span> <span class="n">party_map</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Disambiguates party names in a DataFrame column.</span>

<span class="sd">    This function maps certain party names to a standardized form using a provided dictionary.</span>
<span class="sd">    For example, it can map &quot;BÜNDNIS`90/DIE GRÜNEN&quot; to &quot;BÜ90/GR&quot;.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pl.DataFrame): The DataFrame containing the party names.</span>
<span class="sd">        col (str, optional): The name of the column with party names. Defaults to &quot;Fraktion/Gruppe&quot;.</span>
<span class="sd">        party_map (dict | None, optional): A dictionary for mapping party names. If None, a default map is used.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pl.DataFrame: The DataFrame with the disambiguated party names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">party_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">party_map</span> <span class="o">=</span> <span class="n">PARTY_MAP</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
        <span class="o">**</span><span class="p">{</span>
            <span class="n">col</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">map_elements</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">party_map</span> <span class="k">else</span> <span class="n">party_map</span><span class="p">[</span><span class="n">x</span><span class="p">],</span>
                <span class="n">return_dtype</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">String</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bundestag.data.transform.bundestag_sheets.get_file2poll_maps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_file2poll_maps</span><span class="p">(</span><span class="n">uris</span><span class="p">,</span> <span class="n">sheet_dir</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Creates a mapping from a local file name to a poll title.</p>
<p>This function iterates through a dictionary of poll titles and their corresponding URIs.
For each URI, it generates the expected local filename and checks if the file exists in <code>sheet_dir</code>.
If the file exists, it adds an entry to the map.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>uris</code></b>
                  (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>)
              –
              <div class="doc-md-description">
                <p>A dictionary mapping poll titles to their download URIs.</p>
              </div>
            </li>
            <li>
              <b><code>sheet_dir</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>The directory where the downloaded sheets are stored.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
              –
              <div class="doc-md-description">
                <p>dict[str, str]: A dictionary mapping existing local file names to their poll titles.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/bundestag/data/transform/bundestag_sheets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_file2poll_maps</span><span class="p">(</span><span class="n">uris</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">sheet_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a mapping from a local file name to a poll title.</span>

<span class="sd">    This function iterates through a dictionary of poll titles and their corresponding URIs.</span>
<span class="sd">    For each URI, it generates the expected local filename and checks if the file exists in `sheet_dir`.</span>
<span class="sd">    If the file exists, it adds an entry to the map.</span>

<span class="sd">    Args:</span>
<span class="sd">        uris (dict[str, str]): A dictionary mapping poll titles to their download URIs.</span>
<span class="sd">        sheet_dir (Path): The directory where the downloaded sheets are stored.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, str]: A dictionary mapping existing local file names to their poll titles.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">known_sheets</span> <span class="o">=</span> <span class="n">get_file_paths</span><span class="p">(</span><span class="n">sheet_dir</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">RE_FNAME</span><span class="p">)</span>
    <span class="n">file2poll</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">poll_title</span><span class="p">,</span> <span class="n">uri</span> <span class="ow">in</span> <span class="n">uris</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">get_sheet_filename</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
        <span class="n">sheet_path</span> <span class="o">=</span> <span class="n">sheet_dir</span> <span class="o">/</span> <span class="n">fname</span>
        <span class="k">if</span> <span class="n">sheet_path</span> <span class="ow">in</span> <span class="n">known_sheets</span><span class="p">:</span>
            <span class="n">file2poll</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span> <span class="o">=</span> <span class="n">poll_title</span>
    <span class="k">return</span> <span class="n">file2poll</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bundestag.data.transform.bundestag_sheets.get_multiple_sheets_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_multiple_sheets_df</span><span class="p">(</span><span class="n">sheet_files</span><span class="p">,</span> <span class="n">file_title_maps</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Loads, processes, and concatenates multiple vote sheet files into a single DataFrame.</p>
<p>This function iterates through a list of sheet files, processes each one using <code>get_sheet_df</code>
and <code>get_squished_dataframe</code>, and then concatenates the results. It handles empty files and
files that cause parsing errors by skipping them and logging a warning.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>sheet_files</code></b>
                  (<code><span title="list">list</span>[<span title="pathlib.Path">Path</span>]</code>)
              –
              <div class="doc-md-description">
                <p>A list of paths to the Excel sheet files.</p>
              </div>
            </li>
            <li>
              <b><code>file_title_maps</code></b>
                  (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>)
              –
              <div class="doc-md-description">
                <p>A mapping from file names to full poll titles.</p>
              </div>
            </li>
            <li>
              <b><code>validate</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>A flag for validation passed down to <code>get_squished_dataframe</code>. Defaults to False.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If parsing fails for a specific file with a <code>ValueError</code>.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
              –
              <div class="doc-md-description">
                <p>pl.DataFrame: A single DataFrame containing the data from all processed sheets.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/bundestag/data/transform/bundestag_sheets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_multiple_sheets_df</span><span class="p">(</span>
    <span class="n">sheet_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">],</span>
    <span class="n">file_title_maps</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads, processes, and concatenates multiple vote sheet files into a single DataFrame.</span>

<span class="sd">    This function iterates through a list of sheet files, processes each one using `get_sheet_df`</span>
<span class="sd">    and `get_squished_dataframe`, and then concatenates the results. It handles empty files and</span>
<span class="sd">    files that cause parsing errors by skipping them and logging a warning.</span>

<span class="sd">    Args:</span>
<span class="sd">        sheet_files (list[Path]): A list of paths to the Excel sheet files.</span>
<span class="sd">        file_title_maps (dict[str, str]): A mapping from file names to full poll titles.</span>
<span class="sd">        validate (bool, optional): A flag for validation passed down to `get_squished_dataframe`. Defaults to False.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If parsing fails for a specific file with a `ValueError`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pl.DataFrame: A single DataFrame containing the data from all processed sheets.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loading processing and concatenating multiple vote sheets&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n_empty</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n_errors</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">sheet_file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">sheet_files</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">sheet_files</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Sheets&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file_size_is_zero</span><span class="p">(</span><span class="n">sheet_file</span><span class="p">):</span>
            <span class="n">n_empty</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">sheet_file</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file_title_maps</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sheet_df</span> <span class="o">=</span> <span class="n">get_sheet_df</span><span class="p">(</span><span class="n">sheet_file</span><span class="p">,</span> <span class="n">file_title_maps</span><span class="o">=</span><span class="n">file_title_maps</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ExcelReadException</span><span class="p">:</span>
            <span class="n">n_errors</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">sheet_df</span> <span class="o">=</span> <span class="n">get_squished_dataframe</span><span class="p">(</span><span class="n">sheet_df</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parsing failed for </span><span class="si">{</span><span class="n">sheet_file</span><span class="si">}</span><span class="s2"> with ValueError: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sheet_df</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sheet_files</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_empty</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n_empty</span><span class="si">:</span><span class="s2">_</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">n</span><span class="si">:</span><span class="s2">_</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">n_empty</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2"> % files were empty.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_errors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n_errors</span><span class="si">:</span><span class="s2">_</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">n</span><span class="si">:</span><span class="s2">_</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">n_errors</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2"> % files skipped due to some excel parsing error, likely xls files.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bundestag.data.transform.bundestag_sheets.get_sheet_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sheet_df</span><span class="p">(</span><span class="n">sheet_file</span><span class="p">,</span> <span class="n">file_title_maps</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Parses a single Excel sheet file into a processed Polars DataFrame.</p>
<p>This function orchestrates the reading and processing of a single sheet file, including:
1. Reading the Excel file using <code>read_excel</code>.
2. Verifying the integrity of the vote columns.
3. Assigning date and title columns.
4. Disambiguating party names.
5. Ensuring the final DataFrame conforms to a specific schema.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>sheet_file</code></b>
                  (<code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>The path to the Excel sheet file.</p>
              </div>
            </li>
            <li>
              <b><code>file_title_maps</code></b>
                  (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>] | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>A mapping from file names to full poll titles. Defaults to None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
              –
              <div class="doc-md-description">
                <p>pl.DataFrame: The processed Polars DataFrame.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/bundestag/data/transform/bundestag_sheets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_sheet_df</span><span class="p">(</span>
    <span class="n">sheet_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">file_title_maps</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a single Excel sheet file into a processed Polars DataFrame.</span>

<span class="sd">    This function orchestrates the reading and processing of a single sheet file, including:</span>
<span class="sd">    1. Reading the Excel file using `read_excel`.</span>
<span class="sd">    2. Verifying the integrity of the vote columns.</span>
<span class="sd">    3. Assigning date and title columns.</span>
<span class="sd">    4. Disambiguating party names.</span>
<span class="sd">    5. Ensuring the final DataFrame conforms to a specific schema.</span>

<span class="sd">    Args:</span>
<span class="sd">        sheet_file (str | Path): The path to the Excel sheet file.</span>
<span class="sd">        file_title_maps (dict[str, str] | None, optional): A mapping from file names to full poll titles. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pl.DataFrame: The processed Polars DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sheet_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sheet_file</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">read_excel</span><span class="p">(</span><span class="n">sheet_file</span><span class="p">)</span>

    <span class="n">verify_vote_columns</span><span class="p">(</span><span class="n">sheet_file</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">assign_date_and_title_columns</span><span class="p">(</span><span class="n">sheet_file</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">file_title_maps</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">disambiguate_party</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">schema</span><span class="o">=</span><span class="n">SHEET_SCHEMA_GET_SHEET_DF</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bundestag.data.transform.bundestag_sheets.get_sheet_uris_from_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_sheet_uris_from_json</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">json_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Loads sheet URIs from a JSON file.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>source</code></b>
                  (<code><span title="bundestag.data.download.bundestag_sheets.Source">Source</span></code>)
              –
              <div class="doc-md-description">
                <p>The source type, used for raising a more informative error.</p>
              </div>
            </li>
            <li>
              <b><code>json_path</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>The path to the JSON file containing the sheet URIs.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If the specified JSON file does not exist.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
              –
              <div class="doc-md-description">
                <p>dict[str, str]: A dictionary of sheet URIs loaded from the JSON file.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/bundestag/data/transform/bundestag_sheets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_sheet_uris_from_json</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="n">Source</span><span class="p">,</span> <span class="n">json_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads sheet URIs from a JSON file.</span>

<span class="sd">    Args:</span>
<span class="sd">        source (Source): The source type, used for raising a more informative error.</span>
<span class="sd">        json_path (Path): The path to the JSON file containing the sheet URIs.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the specified JSON file does not exist.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, str]: A dictionary of sheet URIs loaded from the JSON file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">json_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Running this function with </span><span class="si">{</span><span class="n">source</span><span class="si">=}</span><span class="s2"> requires that </span><span class="si">{</span><span class="n">json_path</span><span class="si">=}</span><span class="s2"> exists.&quot;</span>
        <span class="p">)</span>
    <span class="k">with</span> <span class="n">json_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">sheet_uris</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sheet_uris</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bundestag.data.transform.bundestag_sheets.get_squished_dataframe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_squished_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">id_col</span><span class="o">=</span><span class="s1">&#39;Bezeichnung&#39;</span><span class="p">,</span> <span class="n">feature_cols</span><span class="o">=</span><span class="n">VOTE_COLS</span><span class="p">,</span> <span class="n">other_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reformats a DataFrame by squishing the vote columns into a single 'vote' column.</p>
<p>This function also creates a new 'issue' column by combining the date and title of the vote.
It's a key step in transforming the data from a wide format to a long format that's easier to analyze.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df</code></b>
                  (<code><span title="polars.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>The input DataFrame.</p>
              </div>
            </li>
            <li>
              <b><code>id_col</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>&#39;Bezeichnung&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The identifier column. Defaults to "Bezeichnung".</p>
              </div>
            </li>
            <li>
              <b><code>feature_cols</code></b>
                  (<code><span title="list">list</span>[<span title="str">str</span>]</code>, default:
                      <code><span title="bundestag.data.transform.bundestag_sheets.VOTE_COLS">VOTE_COLS</span></code>
)
              –
              <div class="doc-md-description">
                <p>The list of vote columns to be squished. Defaults to VOTE_COLS.</p>
              </div>
            </li>
            <li>
              <b><code>other_cols</code></b>
                  (<code><span title="list">list</span> | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Other columns to include in the transformation. Defaults to None.</p>
              </div>
            </li>
            <li>
              <b><code>validate</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>A flag for validation (currently unused). Defaults to False.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If 'date' or 'title' information is missing for any row.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
              –
              <div class="doc-md-description">
                <p>pl.DataFrame: The reformatted DataFrame with a single 'vote' column and an 'issue' column.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/bundestag/data/transform/bundestag_sheets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_squished_dataframe</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">id_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Bezeichnung&quot;</span><span class="p">,</span>
    <span class="n">feature_cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">VOTE_COLS</span><span class="p">,</span>
    <span class="n">other_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reformats a DataFrame by squishing the vote columns into a single &#39;vote&#39; column.</span>

<span class="sd">    This function also creates a new &#39;issue&#39; column by combining the date and title of the vote.</span>
<span class="sd">    It&#39;s a key step in transforming the data from a wide format to a long format that&#39;s easier to analyze.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pl.DataFrame): The input DataFrame.</span>
<span class="sd">        id_col (str, optional): The identifier column. Defaults to &quot;Bezeichnung&quot;.</span>
<span class="sd">        feature_cols (list[str], optional): The list of vote columns to be squished. Defaults to VOTE_COLS.</span>
<span class="sd">        other_cols (list | None, optional): Other columns to include in the transformation. Defaults to None.</span>
<span class="sd">        validate (bool, optional): A flag for validation (currently unused). Defaults to False.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If &#39;date&#39; or &#39;title&#39; information is missing for any row.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pl.DataFrame: The reformatted DataFrame with a single &#39;vote&#39; column and an &#39;issue&#39; column.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">other_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">other_cols</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">other_cols</span>
    <span class="n">df_sub</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">id_col</span><span class="p">]</span> <span class="o">+</span> <span class="n">feature_cols</span> <span class="o">+</span> <span class="n">other_cols</span><span class="p">)</span>

    <span class="c1"># add issue column</span>
    <span class="n">df_sub</span> <span class="o">=</span> <span class="n">df_sub</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
        <span class="o">**</span><span class="p">{</span>
            <span class="s2">&quot;date or title missing&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span>
            <span class="o">|</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">n_missing</span> <span class="o">=</span> <span class="n">df_sub</span><span class="p">[</span><span class="s2">&quot;date or title missing&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">n_missing</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># TODO: that this can happen is weird - error in processing?</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Missing date and or title information for </span><span class="si">{</span><span class="n">n_missing</span><span class="si">:</span><span class="s2">_</span><span class="si">}</span><span class="s2"> rows (</span><span class="si">{</span><span class="n">n_missing</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">df_sub</span><span class="p">)</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">), did you provide file_title_maps upstream?&quot;</span>
        <span class="p">)</span>

    <span class="n">df_sub</span> <span class="o">=</span> <span class="n">df_sub</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;date or title missing&quot;</span><span class="p">)</span>

    <span class="n">df_sub</span> <span class="o">=</span> <span class="n">df_sub</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;issue&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">String</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)}</span>
    <span class="p">)</span>

    <span class="n">df_sub</span> <span class="o">=</span> <span class="n">create_vote_column</span><span class="p">(</span><span class="n">df_sub</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">VOTE_COLS</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">df_sub</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">VOTE_COLS</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Bezeichnung&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">schema</span><span class="o">=</span><span class="n">SHEET_SCHEMA_GET_SQUISHED_DATAFRAME</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bundestag.data.transform.bundestag_sheets.handle_title_and_date" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">handle_title_and_date</span><span class="p">(</span><span class="n">full_title</span><span class="p">,</span> <span class="n">sheet_file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Extracts the title of the roll call vote and the date from a full title string.</p>
<p>It first attempts to parse a date from the beginning of the <code>full_title</code>.
If successful, the rest of the string is considered the title.
If not, it tries to parse a date from the <code>sheet_file</code> name.
If neither works, it returns the original title and None for the date.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>full_title</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>The full title string, which may contain a date.</p>
              </div>
            </li>
            <li>
              <b><code>sheet_file</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>The path to the sheet file, used as a fallback for date extraction.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="tuple">tuple</span>[<span title="str">str</span>, <span title="datetime.date">date</span> | None]</code>
              –
              <div class="doc-md-description">
                <p>tuple[str, datetime.date | None]: A tuple containing the extracted title and the date (or None).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/bundestag/data/transform/bundestag_sheets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">handle_title_and_date</span><span class="p">(</span>
    <span class="n">full_title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sheet_file</span><span class="p">:</span> <span class="n">Path</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts the title of the roll call vote and the date from a full title string.</span>

<span class="sd">    It first attempts to parse a date from the beginning of the `full_title`.</span>
<span class="sd">    If successful, the rest of the string is considered the title.</span>
<span class="sd">    If not, it tries to parse a date from the `sheet_file` name.</span>
<span class="sd">    If neither works, it returns the original title and None for the date.</span>

<span class="sd">    Args:</span>
<span class="sd">        full_title (str): The full title string, which may contain a date.</span>
<span class="sd">        sheet_file (Path): The path to the sheet file, used as a fallback for date extraction.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[str, datetime.date | None]: A tuple containing the extracted title and the date (or None).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get date from full_title</span>
    <span class="n">title_clean</span> <span class="o">=</span> <span class="n">full_title</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">title_clean</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
    <span class="n">date_in_title</span> <span class="o">=</span> <span class="n">title</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">title_has_date</span> <span class="o">=</span> <span class="n">is_date</span><span class="p">(</span><span class="n">date_in_title</span><span class="p">,</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># get date from file name</span>
    <span class="n">date_in_fname</span> <span class="o">=</span> <span class="n">sheet_file</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">fname_has_date</span> <span class="o">=</span> <span class="n">is_date</span><span class="p">(</span><span class="n">date_in_fname</span><span class="p">,</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">title_has_date</span><span class="p">:</span>
        <span class="n">date</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parse_date</span><span class="p">(</span><span class="n">date_in_title</span><span class="p">,</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">title</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">title</span><span class="p">,</span> <span class="n">date</span>
    <span class="k">elif</span> <span class="n">fname_has_date</span><span class="p">:</span>
        <span class="n">date</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parse_date</span><span class="p">(</span><span class="n">date_in_fname</span><span class="p">,</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">title_clean</span><span class="p">,</span> <span class="n">date</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">title_clean</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bundestag.data.transform.bundestag_sheets.is_date" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_date</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">dayfirst</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Checks if a string can be parsed as a date.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>s</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>The string to check.</p>
              </div>
            </li>
            <li>
              <b><code>dayfirst</code></b>
                  (<code><span title="bool">bool</span></code>)
              –
              <div class="doc-md-description">
                <p>If True, assumes formats like 'dd.mm.yyyy'. Otherwise, assumes 'yyyy-mm-dd'.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>bool</code></b>(                  <code><span title="bool">bool</span></code>
)              –
              <div class="doc-md-description">
                <p>True if the string can be parsed as a date, False otherwise.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/bundestag/data/transform/bundestag_sheets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_date</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dayfirst</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if a string can be parsed as a date.</span>

<span class="sd">    Args:</span>
<span class="sd">        s (str): The string to check.</span>
<span class="sd">        dayfirst (bool): If True, assumes formats like &#39;dd.mm.yyyy&#39;. Otherwise, assumes &#39;yyyy-mm-dd&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the string can be parsed as a date, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parsed_date</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parse_date</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">dayfirst</span><span class="o">=</span><span class="n">dayfirst</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parsed_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bundestag.data.transform.bundestag_sheets.parse_date" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_date</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">dayfirst</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Parses a date string into a datetime object.</p>
<p>This function tries to parse a date string using a list of predefined formats.
The formats depend on whether the day or the year is expected to be first.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>date</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>The date string to parse.</p>
              </div>
            </li>
            <li>
              <b><code>dayfirst</code></b>
                  (<code><span title="bool">bool</span></code>)
              –
              <div class="doc-md-description">
                <p>If True, assumes formats like 'dd.mm.yyyy'. Otherwise, assumes 'yyyy-mm-dd'.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="tuple">tuple</span>[<span title="datetime.date">date</span> | None, <span title="str">str</span>]</code>
              –
              <div class="doc-md-description">
                <p>tuple[datetime.date | None, str]: A tuple containing the parsed datetime object (or None if parsing fails)
                               and the format string that was successfully used.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/bundestag/data/transform/bundestag_sheets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_date</span><span class="p">(</span><span class="n">date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dayfirst</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parses a date string into a datetime object.</span>

<span class="sd">    This function tries to parse a date string using a list of predefined formats.</span>
<span class="sd">    The formats depend on whether the day or the year is expected to be first.</span>

<span class="sd">    Args:</span>
<span class="sd">        date (str): The date string to parse.</span>
<span class="sd">        dayfirst (bool): If True, assumes formats like &#39;dd.mm.yyyy&#39;. Otherwise, assumes &#39;yyyy-mm-dd&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[datetime.date | None, str]: A tuple containing the parsed datetime object (or None if parsing fails)</span>
<span class="sd">                                           and the format string that was successfully used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dayfirst</span><span class="p">:</span>
        <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">.%m.%Y&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">%m%y&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="n">parsed_date</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">matched_format</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">formats</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parsed_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">matched_format</span> <span class="o">=</span> <span class="n">f</span>
            <span class="k">break</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">return</span> <span class="n">parsed_date</span><span class="p">,</span> <span class="n">matched_format</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bundestag.data.transform.bundestag_sheets.read_excel" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_excel</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Reads an Excel file into a Polars DataFrame, trying different engines.</p>
<p>This function first attempts to read the Excel file using the 'openpyxl' engine.
If that fails, it falls back to the 'xlrd' engine. It also handles cases where
the file has multiple sheets (raising an error) and ensures that certain optional
columns ('AbgNr', 'Bemerkung') exist in the final DataFrame.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>file</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>The path to the Excel file.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If the Excel file contains more than one sheet.</p>
              </div>
            </li>
            <li>
                  <code><span title="bundestag.data.transform.bundestag_sheets.ExcelReadException">ExcelReadException</span></code>
              –
              <div class="doc-md-description">
                <p>If both 'openpyxl' and 'xlrd' engines fail to read the file.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="polars.DataFrame">DataFrame</span></code>
              –
              <div class="doc-md-description">
                <p>pl.DataFrame: A Polars DataFrame containing the data from the Excel sheet.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/bundestag/data/transform/bundestag_sheets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_excel</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads an Excel file into a Polars DataFrame, trying different engines.</span>

<span class="sd">    This function first attempts to read the Excel file using the &#39;openpyxl&#39; engine.</span>
<span class="sd">    If that fails, it falls back to the &#39;xlrd&#39; engine. It also handles cases where</span>
<span class="sd">    the file has multiple sheets (raising an error) and ensures that certain optional</span>
<span class="sd">    columns (&#39;AbgNr&#39;, &#39;Bemerkung&#39;) exist in the final DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        file (Path): The path to the Excel file.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the Excel file contains more than one sheet.</span>
<span class="sd">        ExcelReadException: If both &#39;openpyxl&#39; and &#39;xlrd&#39; engines fail to read the file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pl.DataFrame: A Polars DataFrame containing the data from the Excel sheet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;openpyxl&quot;</span><span class="p">)</span>
        <span class="c1"># sanity check that there is only one sheet</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">=}</span><span class="s2"> has more than one page, that&#39;s unexpected.&quot;</span><span class="p">)</span>

            <span class="n">sheet_name</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;sheet_name&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="n">sheet_name</span><span class="p">)})</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">dfs</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;sheet_name&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)})</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;xlrd&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">xlrd</span><span class="o">.</span><span class="n">biffh</span><span class="o">.</span><span class="n">XLRDError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExcelReadException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to parse </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;sheet_name&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)})</span>

    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;AbgNr&quot;</span><span class="p">,</span> <span class="s2">&quot;Bemerkung&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">schema</span><span class="o">=</span><span class="n">SHEET_SCHEMA_READ_EXCEL</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bundestag.data.transform.bundestag_sheets.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">html_dir</span><span class="p">,</span> <span class="n">sheet_dir</span><span class="p">,</span> <span class="n">preprocessed_path</span><span class="p">,</span> <span class="n">dry</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">assume_yes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">Source</span><span class="o">.</span><span class="n">html_file</span><span class="p">,</span> <span class="n">json_filename</span><span class="o">=</span><span class="s1">&#39;xlsx_uris.json&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Main function to run the Bundestag sheet parsing and transformation pipeline.</p>
<pre><code>This function orchestrates the entire process of turning raw Excel sheets into a
single, clean Parquet file. It can source the URIs for the sheets from either
</code></pre>
<p>al HTML files or a pre-existing JSON file.</p>
<pre><code>Args:
    html_dir (Path): The directory containing HTML files (if source is 'html_file') or the parent of the JSON file.
    sheet_dir (Path): The directory where the raw Excel sheets are stored.
    preprocessed_path (Path): The directory where the final Parquet file will be saved.
    dry (bool, optional): If True, performs a dry run without writing any files. Defaults to False.
    validate (bool, optional): A flag for validation during processing. Defaults to False.
    assume_yes (bool, optional): If True, automatically creates the preprocessed path if it doesn't exist. Defaults to False.
    source (Source, optional): The source of the sheet URIs ('html_file' or 'json_file'). Defaults to Source.html_file.
    json_filename (str, optional): The name of the JSON file with URIs. Defaults to "xlsx_uris.json".

Raises:
    ValueError: If required directories do not exist, or if the JSON source file is missing.
</code></pre>


            <details class="quote">
              <summary>Source code in <code>src/bundestag/data/transform/bundestag_sheets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
    <span class="n">html_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">sheet_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">preprocessed_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">dry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">assume_yes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">source</span><span class="p">:</span> <span class="n">Source</span> <span class="o">=</span> <span class="n">Source</span><span class="o">.</span><span class="n">html_file</span><span class="p">,</span>
    <span class="n">json_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;xlsx_uris.json&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main function to run the Bundestag sheet parsing and transformation pipeline.</span>

<span class="sd">        This function orchestrates the entire process of turning raw Excel sheets into a</span>
<span class="sd">        single, clean Parquet file. It can source the URIs for the sheets from either</span>
<span class="sd">    al HTML files or a pre-existing JSON file.</span>

<span class="sd">        Args:</span>
<span class="sd">            html_dir (Path): The directory containing HTML files (if source is &#39;html_file&#39;) or the parent of the JSON file.</span>
<span class="sd">            sheet_dir (Path): The directory where the raw Excel sheets are stored.</span>
<span class="sd">            preprocessed_path (Path): The directory where the final Parquet file will be saved.</span>
<span class="sd">            dry (bool, optional): If True, performs a dry run without writing any files. Defaults to False.</span>
<span class="sd">            validate (bool, optional): A flag for validation during processing. Defaults to False.</span>
<span class="sd">            assume_yes (bool, optional): If True, automatically creates the preprocessed path if it doesn&#39;t exist. Defaults to False.</span>
<span class="sd">            source (Source, optional): The source of the sheet URIs (&#39;html_file&#39; or &#39;json_file&#39;). Defaults to Source.html_file.</span>
<span class="sd">            json_filename (str, optional): The name of the JSON file with URIs. Defaults to &quot;xlsx_uris.json&quot;.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If required directories do not exist, or if the JSON source file is missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Start parsing sheets&quot;</span><span class="p">)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>
    <span class="c1"># ensuring path exists</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dry</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">html_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">html_dir</span><span class="si">=}</span><span class="s2"> doesn&#39;t exist, terminating transformation.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dry</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">sheet_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sheet_dir</span><span class="si">=}</span><span class="s2"> doesn&#39;t exist, terminating transformation.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dry</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">preprocessed_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">ensure_path_exists</span><span class="p">(</span><span class="n">preprocessed_path</span><span class="p">,</span> <span class="n">assume_yes</span><span class="o">=</span><span class="n">assume_yes</span><span class="p">)</span>

    <span class="n">html_dir</span><span class="p">,</span> <span class="n">sheet_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">html_dir</span><span class="p">),</span> <span class="n">Path</span><span class="p">(</span><span class="n">sheet_dir</span><span class="p">)</span>

    <span class="k">match</span> <span class="n">source</span><span class="p">:</span>
        <span class="k">case</span> <span class="n">Source</span><span class="o">.</span><span class="n">json_file</span><span class="p">:</span>
            <span class="n">json_path</span> <span class="o">=</span> <span class="n">html_dir</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">json_filename</span>

            <span class="n">sheet_uris</span> <span class="o">=</span> <span class="n">get_sheet_uris_from_json</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">json_path</span><span class="p">)</span>

        <span class="k">case</span> <span class="n">Source</span><span class="o">.</span><span class="n">html_file</span><span class="p">:</span>
            <span class="c1"># collect htm files</span>
            <span class="n">html_file_paths</span> <span class="o">=</span> <span class="n">get_file_paths</span><span class="p">(</span><span class="n">html_dir</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">RE_HTM</span><span class="p">)</span>
            <span class="c1"># extract excel sheet uris from htm files</span>
            <span class="n">sheet_uris</span> <span class="o">=</span> <span class="n">collect_sheet_uris</span><span class="p">(</span><span class="n">html_file_paths</span><span class="p">)</span>

    <span class="c1"># locate downloaded excel files</span>
    <span class="n">sheet_files</span> <span class="o">=</span> <span class="n">get_file_paths</span><span class="p">(</span><span class="n">sheet_dir</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">RE_FNAME</span><span class="p">)</span>
    <span class="c1"># process excel files</span>
    <span class="n">file_title_maps</span> <span class="o">=</span> <span class="n">get_file2poll_maps</span><span class="p">(</span><span class="n">sheet_uris</span><span class="p">,</span> <span class="n">sheet_dir</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">get_multiple_sheets_df</span><span class="p">(</span>
        <span class="n">sheet_files</span><span class="p">,</span> <span class="n">file_title_maps</span><span class="o">=</span><span class="n">file_title_maps</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="n">validate</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dry</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">preprocessed_path</span> <span class="o">/</span> <span class="s2">&quot;bundestag.de_votes.parquet&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing to </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">write_parquet</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="n">dt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Done parsing sheets after </span><span class="si">{</span><span class="n">dt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="bundestag.data.transform.bundestag_sheets.verify_vote_columns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">verify_vote_columns</span><span class="p">(</span><span class="n">sheet_file</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Verifies that the vote columns in the DataFrame are plausible.</p>
<p>This function checks that for each row, exactly one of the vote columns
('ja', 'nein', 'Enthaltung', 'ungültig', 'nichtabgegeben') has a value of 1.
If any row has a sum of these columns not equal to 1, it indicates an implausible vote.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>sheet_file</code></b>
                  (<code><span title="pathlib.Path">Path</span></code>)
              –
              <div class="doc-md-description">
                <p>The path of the sheet file being verified, for logging purposes.</p>
              </div>
            </li>
            <li>
              <b><code>df</code></b>
                  (<code><span title="polars.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>The DataFrame containing the vote data.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="ValueError">ValueError</span></code>
              –
              <div class="doc-md-description">
                <p>If any row has an implausible vote count.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/bundestag/data/transform/bundestag_sheets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">verify_vote_columns</span><span class="p">(</span><span class="n">sheet_file</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verifies that the vote columns in the DataFrame are plausible.</span>

<span class="sd">    This function checks that for each row, exactly one of the vote columns</span>
<span class="sd">    (&#39;ja&#39;, &#39;nein&#39;, &#39;Enthaltung&#39;, &#39;ungültig&#39;, &#39;nichtabgegeben&#39;) has a value of 1.</span>
<span class="sd">    If any row has a sum of these columns not equal to 1, it indicates an implausible vote.</span>

<span class="sd">    Args:</span>
<span class="sd">        sheet_file (Path): The path of the sheet file being verified, for logging purposes.</span>
<span class="sd">        df (pl.DataFrame): The DataFrame containing the vote data.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If any row has an implausible vote count.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tmp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
        <span class="o">**</span><span class="p">{</span><span class="s2">&quot;hits&quot;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">VOTE_COLS</span><span class="p">)</span><span class="o">.</span><span class="n">sum_horizontal</span><span class="p">()}</span>
    <span class="p">)</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s2">&quot;implausible&quot;</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;hits&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ne</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))})</span>

    <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;implausible&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sheet_file</span><span class="si">=}</span><span class="s2"> has rows with more than one vote:</span><span class="se">\n</span><span class="si">{</span><span class="n">tmp</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;implausible&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../abgeordnetenwatch/process/votes/" class="btn btn-neutral float-left" title="votes"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../utils/" class="btn btn-neutral float-right" title="utils">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/eschmidt42/bundestag/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../abgeordnetenwatch/process/votes/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../utils/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../../..";</script>
    <script src="../../../../js/theme_extra.js"></script>
    <script src="../../../../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
