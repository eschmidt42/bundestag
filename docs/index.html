---

title: Finding matches for MdBs


keywords: fastai
sidebar: home_sidebar

summary: "Ever wondered, given an MdB, which are the most similar MdBs based on their voting behavior? This is what this repo does."
description: "Ever wondered, given an MdB, which are the most similar MdBs based on their voting behavior? This is what this repo does."
nb_path: "nbs/index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Downloading-the-data">Downloading the data<a class="anchor-link" href="#Downloading-the-data"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The German Parliament is so friendly to put all votes of all members into readable XLSX / XLS files, which can be found here: <a href="https://www.bundestag.de/parlament/plenum/abstimmung/liste">https://www.bundestag.de/parlament/plenum/abstimmung/liste</a>.</p>
<p>Let's first define the source dir with the html data and and the target dir for the downloaded XLSX / XLS files</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">html_data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../raw_data&#39;</span><span class="p">)</span>
<span class="n">xlsx_data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../xlsx_data&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now let's collect the relevant URIs from the html documents</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">html_file_paths</span> <span class="o">=</span> <span class="n">parsing</span><span class="o">.</span><span class="n">get_file_paths</span><span class="p">(</span><span class="n">html_data_dir</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.htm&#39;</span><span class="p">)</span>
<span class="n">xlsx_uris</span> <span class="o">=</span> <span class="n">parsing</span><span class="o">.</span><span class="n">collect_xlsx_uris</span><span class="p">(</span><span class="n">html_file_paths</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With the URIs we can now download the XLSX / XLS files</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">xlsx_file_title_maps</span> <span class="o">=</span> <span class="n">parsing</span><span class="o">.</span><span class="n">download_multiple_xlsx_files</span><span class="p">(</span><span class="n">xlsx_uris</span><span class="p">,</span> <span class="n">xlsx_dir</span><span class="o">=</span><span class="n">xlsx_data_dir</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and store them in a <code>pd.DataFrame</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xlsx_files</span> <span class="o">=</span> <span class="n">parsing</span><span class="o">.</span><span class="n">get_file_paths</span><span class="p">(</span><span class="n">xlsx_data_dir</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(\.xlsx?)&#39;</span><span class="p">))</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">parsing</span><span class="o">.</span><span class="n">collect_xlsxs_as_dict</span><span class="p">(</span><span class="n">xlsx_files</span><span class="p">,</span> <span class="n">xlsx_file_title_maps</span><span class="o">=</span><span class="n">xlsx_file_title_maps</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Calculating-Similarities-between-MdBs-(Mitglied-des-Bundestages)">Calculating Similarities between MdBs (Mitglied des Bundestages)<a class="anchor-link" href="#Calculating-Similarities-between-MdBs-(Mitglied-des-Bundestages)"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before we can process the similarities / agreements between the MdBs let's reshape <a href="/bundestag/gui.html#df"><code>df</code></a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_squished</span> <span class="o">=</span> <span class="n">similarity</span><span class="o">.</span><span class="n">get_squished_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and now for the agreements between the MdBs</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">agreements</span> <span class="o">=</span> <span class="n">similarity</span><span class="o">.</span><span class="n">scan_all_agreements</span><span class="p">(</span><span class="n">df_squished</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With agreement between two MdBs we here use 1 - <a href="https://en.wikipedia.org/wiki/Jaccard_index">Jaccard distance</a> times 100. This is the intersection of the issues pairs of MdBs have voted on in the same way divided by the total number of issues the pairs have voted on this way. So if two MdBs have voted on all the same issues and voted always the same way their agreement is 100%.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Running-the-GUI">Running the GUI<a class="anchor-link" href="#Running-the-GUI"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using just calculated <a href="/bundestag/gui.html#df"><code>df</code></a> and <code>agreements</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_gui</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">GUI</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">agreements</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using pre-computed <a href="/bundestag/gui.html#df"><code>df</code></a> and <code>agreements</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_gui</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">GUI</span><span class="p">(</span><span class="n">gui</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">gui</span><span class="o">.</span><span class="n">agreements</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Running the GUI</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_gui</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

